.catalog:
  name: "Nuxeo"
  version: "9.2"
  description: "Digital Asset Management"
  uuid: nx-1
  minimum_rancher_version: v1.1.0
  questions:
    - variable: clid
      description: "A valid CLID to be able to download packages from Nuxeo Online Services. in the form part1\npart2"
      label: "CLID"
      type: "string"
      required: false
      default: ""
    - variable: "packages"
      type: "string"
      label: "List of Nuxeo packages"
      description: |
        List of Nuxeo packages
      default: nuxeo-web-ui nuxeo-jsf-ui nuxeo-drive nuxeo-diff nuxeo-spreadsheet nuxeo-dam nuxeo-template-rendering nuxeo-template-rendering-samples nuxeo-showcase-content
    - variable: url
      description: "The URL that this nuxeo instance should serve"
      label: "Nuxeo URL"
      type: "string"
      required: true
      default: "http://catalog.apps.tomahawk-media.com/"
    - variable: volumedriver
      type: "string"
      label: "Volume driver"
      description: |
        Specifiy docker volume driver to use
      default: local
    - variable: "cluster_name"
      type: "string"
      required: true
      label: "Cluster name"
      description: "Name of the Elasticsearch Cluster"
      default: "es-cluster"

    - variable: "UPDATE_SYSCTL"
      label: "Update host sysctl:"
      description: |
        Set true to avoid vm.max_map_count errors.
        WARN: If set true, host param vm.max_map_count will be update to 262144.
      default: true
      required: true
      type: enum
      options:
        - false
        - true

    - variable: "master_heap_size"
      type: "string"
      required: true
      label: "Heap size (master nodes)"
      description: "Heap size to be allocated for Java (master nodes)"
      default: "512m"

    - variable: "master_mem_limit"
      type: "int"
      required: true
      label: "Memory limit in byte (master nodes)"
      description: "Memory limit in Byte per elasticsearch container. AT LEAST double the heap size! (master nodes)"
      default: 1073741824

    - variable: "data_heap_size"
      type: "string"
      required: true
      label: "Heap size (data nodes)"
      description: "Heap size to be allocated for Java (data nodes)"
      default: "512m"

    - variable: "data_mem_limit"
      type: "int"
      required: true
      label: "Memory limit in byte (data nodes)"
      description: "Memory limit in Byte per elasticsearch container. AT LEAST double the heap size! (data nodes)"
      default: 1073741824

    - variable: "client_heap_size"
      type: "string"
      required: true
      label: "Heap size (client nodes)"
      description: "Heap size to be allocated for Java (client nodes)"
      default: "512m"

    - variable: "client_mem_limit"
      type: "int"
      required: true
      label: "Memory limit in byte (client nodes)"
      description: "Memory limit in Byte per elasticsearch container. AT LEAST double the heap size! (client nodes)"
      default: 1073741824

    - variable: "minimum_master_nodes"
      type: "int"
      required: true
      label: "# of minimum Master Nodes"
      description: "Set the number of required master nodes to reach quorum. Sets initial scale to this value as well"
      default: 1

    - variable: "initial_data_nodes"
      type: "int"
      required: true
      label: "# of initial data nodes"
      description: "Set the initial number of data nodes"
      default: 2

    - variable: "initial_client_nodes"
      type: "int"
      required: true
      label: "# of initial client nodes"
      description: "Set the initial number of client nodes"
      default: 1

    - variable: "VOLUME_DRIVER"
      description: "The VOLUME driver to associate with this server"
      label: "VOLUME Driver"
      required: true
      default: "local"
      type: enum
      options:
        - local
        - rancher-nfs
        - rancher-efs
        - rancher-ebs
nuxeo:
  scale: 1
  health_check:
    port: 8080
    # Interval is measured in milliseconds
    interval: 5000
    unhealthy_threshold: 5
    # For TCP, request_line needs to be ''
    # TCP Example:
    # request_line: ''
    request_line: GET /nuxeo/login.jsp
    healthy_threshold: 2
    # Response timeout is measured in milliseconds
    response_timeout: 2000

lb:
  scale: 1
  load_balancer_config:
    lb_cookie_stickiness_policy:
      cookie: lbsticky
    haproxy_config: {}
  health_check:
    port: 42
    interval: 2000
    unhealthy_threshold: 3
    healthy_threshold: 2
    response_timeout: 2000

services:

  es-master:
    scale: ${minimum_master_nodes}

  es-data:
    scale: ${initial_data_nodes}

  es-client:
    scale: ${initial_client_nodes}
